name: website-deploy

on:
  workflow_dispatch:    

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
    - uses: actions/checkout@v3
        
    - name: install website dependencies
      run: npm install --prefix website

    - name: build website
      run: npm run docusaurus build --prefix website
      
    - name: Set AWS credentials
      uses: aws-actions/configure-aws-credentials@v1
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-region: eu-west-1      
      
    - name: S3 Publisher
      uses: osiegmar/s3-publisher-action@v1
      with:
        bucket: ${{ secrets.S3_BUCKET }}
        dir: website/build
        delete-orphaned: true
